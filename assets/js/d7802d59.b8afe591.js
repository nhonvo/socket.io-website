"use strict";(self.webpackChunksample_website=self.webpackChunksample_website||[]).push([[8748],{5680:(e,t,n)=>{n.d(t,{xA:()=>c,yg:()=>m});var r=n(6540);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=r.createContext({}),p=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=p(e.components);return r.createElement(l.Provider,{value:t},e.children)},g="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),g=p(n),u=o,m=g["".concat(l,".").concat(u)]||g[u]||d[u]||a;return n?r.createElement(m,i(i({ref:t},c),{},{components:n})):r.createElement(m,i({ref:t},c))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,i=new Array(a);i[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[g]="string"==typeof e?e:o,i[1]=s;for(var p=2;p<a;p++)i[p]=n[p];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}u.displayName="MDXCreateElement"},7830:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>a,metadata:()=>s,toc:()=>p});var r=n(8168),o=(n(6540),n(5680));const a={title:"Version 4.7.0",sidebar_label:"4.7.0 (June 22, 2023)",sidebar_position:98,toc_max_heading_level:4},i=void 0,s={unversionedId:"changelog/4.7.0",id:"changelog/4.7.0",title:"Version 4.7.0",description:"June 22, 2023",source:"@site/docs/changelog/4.7.0.md",sourceDirName:"changelog",slug:"/changelog/4.7.0",permalink:"/docs/v4/changelog/4.7.0",draft:!1,editUrl:"https://github.com/socketio/socket.io-website/edit/main/docs/changelog/4.7.0.md",tags:[],version:"current",lastUpdatedAt:1687591121,formattedLastUpdatedAt:"Jun 24, 2023",sidebarPosition:98,frontMatter:{title:"Version 4.7.0",sidebar_label:"4.7.0 (June 22, 2023)",sidebar_position:98,toc_max_heading_level:4},sidebar:"changelogSidebar",previous:{title:"4.7.1 (June 28, 2023)",permalink:"/docs/v4/changelog/4.7.1"},next:{title:"4.6.2 (May 31, 2023)",permalink:"/docs/v4/changelog/4.6.2"}},l={},p=[{value:"Server",id:"server",level:2},{value:"Bug Fixes",id:"bug-fixes",level:3},{value:"Features",id:"features",level:3},{value:"Support for WebTransport",id:"support-for-webtransport",level:4},{value:"Client bundles with CORS headers",id:"client-bundles-with-cors-headers",level:4},{value:"Dependencies",id:"dependencies",level:3},{value:"Client",id:"client",level:2},{value:"Bug Fixes",id:"bug-fixes-1",level:3},{value:"Features",id:"features-1",level:3},{value:"Support for WebTransport",id:"support-for-webtransport-1",level:4},{value:"Cookie management for the Node.js client",id:"cookie-management-for-the-nodejs-client",level:4},{value:"Conditional import of the ESM build with debug logs",id:"conditional-import-of-the-esm-build-with-debug-logs",level:4},{value:"Dependencies",id:"dependencies-1",level:3}],c={toc:p},g="wrapper";function d(e){let{components:t,...n}=e;return(0,o.yg)(g,(0,r.A)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,o.yg)("p",null,(0,o.yg)("em",{parentName:"p"},"June 22, 2023")),(0,o.yg)("h2",{id:"server"},"Server"),(0,o.yg)("h3",{id:"bug-fixes"},"Bug Fixes"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},"remove the Partial modifier from the socket.data type (",(0,o.yg)("a",{parentName:"li",href:"https://github.com/socketio/socket.io/issues/4740"},"#4740"),") (",(0,o.yg)("a",{parentName:"li",href:"https://github.com/socketio/socket.io/commit/e5c62cad60fc7d16fbb024fd9be1d1880f4e6f5f"},"e5c62ca"),")")),(0,o.yg)("h3",{id:"features"},"Features"),(0,o.yg)("h4",{id:"support-for-webtransport"},"Support for WebTransport"),(0,o.yg)("p",null,"The Socket.IO server can now use WebTransport as the underlying transport."),(0,o.yg)("p",null,"WebTransport is a web API that uses the HTTP/3 protocol as a bidirectional transport. It's intended for two-way communications between a web client and an HTTP/3 server."),(0,o.yg)("p",null,"References:"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"https://w3c.github.io/webtransport/"},"https://w3c.github.io/webtransport/")),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"https://developer.mozilla.org/en-US/docs/Web/API/WebTransport"},"https://developer.mozilla.org/en-US/docs/Web/API/WebTransport")),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"https://developer.chrome.com/articles/webtransport/"},"https://developer.chrome.com/articles/webtransport/"))),(0,o.yg)("p",null,"Until WebTransport support lands ",(0,o.yg)("a",{parentName:"p",href:"https://github.com/nodejs/node/issues/38478"},"in Node.js"),", you can use the ",(0,o.yg)("inlineCode",{parentName:"p"},"@fails-components/webtransport")," package:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},'import { readFileSync } from "fs";\nimport { createServer } from "https";\nimport { Server } from "socket.io";\nimport { Http3Server } from "@fails-components/webtransport";\n\n// WARNING: the total length of the validity period MUST NOT exceed two weeks (https://w3c.github.io/webtransport/#custom-certificate-requirements)\nconst cert = readFileSync("/path/to/my/cert.pem");\nconst key = readFileSync("/path/to/my/key.pem");\n\nconst httpsServer = createServer({\n  key,\n  cert\n});\n\nhttpsServer.listen(3000);\n\nconst io = new Server(httpsServer, {\n  transports: ["polling", "websocket", "webtransport"] // WebTransport is not enabled by default\n});\n\nconst h3Server = new Http3Server({\n  port: 3000,\n  host: "0.0.0.0",\n  secret: "changeit",\n  cert,\n  privKey: key,\n});\n\n(async () => {\n  const stream = await h3Server.sessionStream("/engine.io/");\n  const sessionReader = stream.getReader();\n\n  while (true) {\n    const { done, value } = await sessionReader.read();\n    if (done) {\n      break;\n    }\n    io.engine.onWebTransportSession(value);\n  }\n})();\n\nh3Server.startServer();\n')),(0,o.yg)("p",null,"Added in ",(0,o.yg)("a",{parentName:"p",href:"https://github.com/socketio/engine.io/commit/123b68c04f9e971f59b526e0f967a488ee6b0116"},"123b68c"),"."),(0,o.yg)("h4",{id:"client-bundles-with-cors-headers"},"Client bundles with CORS headers"),(0,o.yg)("p",null,"The bundles will now have the right ",(0,o.yg)("inlineCode",{parentName:"p"},"Access-Control-Allow-xxx")," headers."),(0,o.yg)("p",null,"Added in ",(0,o.yg)("a",{parentName:"p",href:"https://github.com/socketio/socket.io/commit/63f181cc12cbbbf94ed40eef52d60f36a1214fbe"},"63f181c"),"."),(0,o.yg)("h3",{id:"dependencies"},"Dependencies"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"https://github.com/socketio/engine.io/releases/tag/6.5.0"},(0,o.yg)("inlineCode",{parentName:"a"},"engine.io@~6.5.0"))," (",(0,o.yg)("a",{parentName:"li",href:"https://github.com/socketio/engine.io/compare/6.4.2...6.5.0"},"diff"),")"),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"https://github.com/websockets/ws/releases/tag/8.11.0"},(0,o.yg)("inlineCode",{parentName:"a"},"ws@~8.11.0"))," (no change)")),(0,o.yg)("h2",{id:"client"},"Client"),(0,o.yg)("h3",{id:"bug-fixes-1"},"Bug Fixes"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},"properly report timeout error when connecting (",(0,o.yg)("a",{parentName:"li",href:"https://github.com/socketio/socket.io-client/commit/5bc94b56bc1788bab16d9d514d2c8abf3b1d8f87"},"5bc94b5"),")"),(0,o.yg)("li",{parentName:"ul"},"use same scope for setTimeout and clearTimeout calls (",(0,o.yg)("a",{parentName:"li",href:"https://github.com/socketio/socket.io-client/issues/1568"},"#1568"),") (",(0,o.yg)("a",{parentName:"li",href:"https://github.com/socketio/socket.io-client/commit/f2892aba0beeae7c9be930221655d7da6094c5f1"},"f2892ab"),")")),(0,o.yg)("h3",{id:"features-1"},"Features"),(0,o.yg)("h4",{id:"support-for-webtransport-1"},"Support for WebTransport"),(0,o.yg)("p",null,"The Socket.IO client can now use WebTransport as the underlying transport."),(0,o.yg)("p",null,"WebTransport is a web API that uses the HTTP/3 protocol as a bidirectional transport. It's intended for two-way communications between a web client and an HTTP/3 server."),(0,o.yg)("p",null,"References:"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"https://w3c.github.io/webtransport/"},"https://w3c.github.io/webtransport/")),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"https://developer.mozilla.org/en-US/docs/Web/API/WebTransport"},"https://developer.mozilla.org/en-US/docs/Web/API/WebTransport")),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"https://developer.chrome.com/articles/webtransport/"},"https://developer.chrome.com/articles/webtransport/"))),(0,o.yg)("p",null,(0,o.yg)("strong",{parentName:"p"},"For Node.js clients"),": until WebTransport support lands ",(0,o.yg)("a",{parentName:"p",href:"https://github.com/nodejs/node/issues/38478"},"in Node.js"),", you can use the ",(0,o.yg)("inlineCode",{parentName:"p"},"@fails-components/webtransport")," package:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},'import { WebTransport } from "@fails-components/webtransport";\n\nglobal.WebTransport = WebTransport;\n')),(0,o.yg)("p",null,"Added in ",(0,o.yg)("a",{parentName:"p",href:"https://github.com/socketio/engine.io-client/commit/7195c0f305b482f7b1ca2ed812030caaf72c0906"},"7195c0f"),"."),(0,o.yg)("h4",{id:"cookie-management-for-the-nodejs-client"},"Cookie management for the Node.js client"),(0,o.yg)("p",null,"When setting the ",(0,o.yg)("inlineCode",{parentName:"p"},"withCredentials")," option to ",(0,o.yg)("inlineCode",{parentName:"p"},"true"),", the Node.js client will now include the cookies in the HTTP requests, making it easier to use it with cookie-based sticky sessions."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},'import { io } from "socket.io-client";\n\nconst socket = io("https://example.com", {\n  withCredentials: true\n});\n')),(0,o.yg)("p",null,"Added in ",(0,o.yg)("a",{parentName:"p",href:"https://github.com/socketio/engine.io-client/commit/5fc88a62d4017cdc144fa39b9755deadfff2db34"},"5fc88a6"),"."),(0,o.yg)("h4",{id:"conditional-import-of-the-esm-build-with-debug-logs"},"Conditional import of the ESM build with debug logs"),(0,o.yg)("p",null,"By default, the ESM build does not include the ",(0,o.yg)("inlineCode",{parentName:"p"},"debug")," package in the browser environments, because it increases the bundle size (see ",(0,o.yg)("a",{parentName:"p",href:"https://github.com/socketio/socket.io-client/commit/16b65698aed766e1e645c78847f2e91bfc5b6f56"},"16b6569"),")."),(0,o.yg)("p",null,"Which means that, unfortunately, debug logs are not available in the devtools console, even when setting the ",(0,o.yg)("inlineCode",{parentName:"p"},"localStorage.debug = ...")," attribute."),(0,o.yg)("p",null,"You can now import the build which includes the ",(0,o.yg)("inlineCode",{parentName:"p"},"debug")," packages with a ",(0,o.yg)("a",{parentName:"p",href:"https://nodejs.org/api/packages.html#conditional-exports"},"conditional import"),". Example with vite:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},"import { defineConfig } from 'vite'\nimport react from '@vitejs/plugin-react'\n\nexport default defineConfig({\n  plugins: [react()],\n  server: {\n    port: 4000\n  },\n  resolve: {\n    conditions: [\"development\"]\n  }\n})\n")),(0,o.yg)("p",null,"Reference: ",(0,o.yg)("a",{parentName:"p",href:"https://v2.vitejs.dev/config/#resolve-conditions"},"https://v2.vitejs.dev/config/#resolve-conditions")),(0,o.yg)("p",null,"Added in ",(0,o.yg)("a",{parentName:"p",href:"https://github.com/socketio/socket.io-client/commit/781d753a626d01e675056a2ff4e27f5dd599564f"},"781d753"),"."),(0,o.yg)("h3",{id:"dependencies-1"},"Dependencies"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"https://github.com/socketio/engine.io-client/releases/tag/6.5.0"},(0,o.yg)("inlineCode",{parentName:"a"},"engine.io-client@~6.5.0"))," (",(0,o.yg)("a",{parentName:"li",href:"https://github.com/socketio/engine.io-client/compare/6.4.0...6.5.0"},"diff"),")"),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"https://github.com/websockets/ws/releases/tag/8.11.0"},(0,o.yg)("inlineCode",{parentName:"a"},"ws@~8.11.0"))," (no change)")))}d.isMDXComponent=!0}}]);