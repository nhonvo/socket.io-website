"use strict";(self.webpackChunksample_website=self.webpackChunksample_website||[]).push([[528],{5680:(e,n,a)=>{a.d(n,{xA:()=>p,yg:()=>g});var t=a(6540);function o(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function s(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),a.push.apply(a,t)}return a}function c(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?s(Object(a),!0).forEach((function(n){o(e,n,a[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))}))}return e}function r(e,n){if(null==e)return{};var a,t,o=function(e,n){if(null==e)return{};var a,t,o={},s=Object.keys(e);for(t=0;t<s.length;t++)a=s[t],n.indexOf(a)>=0||(o[a]=e[a]);return o}(e,n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(t=0;t<s.length;t++)a=s[t],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var i=t.createContext({}),l=function(e){var n=t.useContext(i),a=n;return e&&(a="function"==typeof e?e(n):c(c({},n),e)),a},p=function(e){var n=l(e.components);return t.createElement(i.Provider,{value:n},e.children)},m="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},d=t.forwardRef((function(e,n){var a=e.components,o=e.mdxType,s=e.originalType,i=e.parentName,p=r(e,["components","mdxType","originalType","parentName"]),m=l(a),d=o,g=m["".concat(i,".").concat(d)]||m[d]||u[d]||s;return a?t.createElement(g,c(c({ref:n},p),{},{components:a})):t.createElement(g,c({ref:n},p))}));function g(e,n){var a=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var s=a.length,c=new Array(s);c[0]=d;var r={};for(var i in n)hasOwnProperty.call(n,i)&&(r[i]=n[i]);r.originalType=e,r[m]="string"==typeof e?e:o,c[1]=r;for(var l=2;l<s;l++)c[l]=a[l];return t.createElement.apply(null,c)}return t.createElement.apply(null,a)}d.displayName="MDXCreateElement"},6175:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>p,contentTitle:()=>i,default:()=>g,frontMatter:()=>r,metadata:()=>l,toc:()=>m});var t=a(8168),o=(a(6540),a(5680)),s=a(1653),c=a(6025);const r={title:"Namespaces",sidebar_position:1,slug:"/namespaces/"},i=void 0,l={unversionedId:"categories/Advanced/namespaces",id:"categories/Advanced/namespaces",title:"Namespaces",description:'A Namespace is a communication channel that allows you to split the logic of your application over a single shared connection (also called "multiplexing").',source:"@site/docs/categories/06-Advanced/namespaces.md",sourceDirName:"categories/06-Advanced",slug:"/namespaces/",permalink:"/docs/v4/namespaces/",draft:!1,editUrl:"https://github.com/socketio/socket.io-website/edit/main/docs/categories/06-Advanced/namespaces.md",tags:[],version:"current",lastUpdatedAt:1684165320,formattedLastUpdatedAt:"May 15, 2023",sidebarPosition:1,frontMatter:{title:"Namespaces",sidebar_position:1,slug:"/namespaces/"},sidebar:"sidebar",previous:{title:"Azure Service Bus adapter",permalink:"/docs/v4/azure-service-bus-adapter/"},next:{title:"Custom parser",permalink:"/docs/v4/custom-parser/"}},p={},m=[{value:"Introduction",id:"introduction",level:2},{value:"Main namespace",id:"main-namespace",level:2},{value:"Custom namespaces",id:"custom-namespaces",level:2},{value:"Client initialization",id:"client-initialization",level:2},{value:"Dynamic namespaces",id:"dynamic-namespaces",level:2},{value:"Complete API",id:"complete-api",level:2}],u={toc:m},d="wrapper";function g(e){let{components:n,...a}=e;return(0,o.yg)(d,(0,t.A)({},u,a,{components:n,mdxType:"MDXLayout"}),(0,o.yg)("p",null,'A Namespace is a communication channel that allows you to split the logic of your application over a single shared connection (also called "multiplexing").'),(0,o.yg)(s.A,{alt:"Namespace diagram",sources:{light:(0,c.A)("/images/namespaces.png"),dark:(0,c.A)("/images/namespaces-dark.png")},mdxType:"ThemedImage"}),(0,o.yg)("h2",{id:"introduction"},"Introduction"),(0,o.yg)("p",null,"Each namespace has its own:"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"/docs/v4/listening-to-events/"},"event handlers"))),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},'io.of("/orders").on("connection", (socket) => {\n  socket.on("order:list", () => {});\n  socket.on("order:create", () => {});\n});\n\nio.of("/users").on("connection", (socket) => {\n  socket.on("user:list", () => {});\n});\n')),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"/docs/v4/rooms/"},"rooms"))),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},'const orderNamespace = io.of("/orders");\n\norderNamespace.on("connection", (socket) => {\n  socket.join("room1");\n  orderNamespace.to("room1").emit("hello");\n});\n\nconst userNamespace = io.of("/users");\n\nuserNamespace.on("connection", (socket) => {\n  socket.join("room1"); // distinct from the room in the "orders" namespace\n  userNamespace.to("room1").emit("hol\xe0");\n});\n')),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"/docs/v4/middlewares/"},"middlewares"))),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},'const orderNamespace = io.of("/orders");\n\norderNamespace.use((socket, next) => {\n  // ensure the socket has access to the "orders" namespace, and then\n  next();\n});\n\nconst userNamespace = io.of("/users");\n\nuserNamespace.use((socket, next) => {\n  // ensure the socket has access to the "users" namespace, and then\n  next();\n});\n')),(0,o.yg)("p",null,"Possible use cases:"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},"you want to create a special namespace that only authorized users have access to, so the logic related to those users is separated from the rest of the application")),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},'const adminNamespace = io.of("/admin");\n\nadminNamespace.use((socket, next) => {\n  // ensure the user has sufficient rights\n  next();\n});\n\nadminNamespace.on("connection", socket => {\n  socket.on("delete user", () => {\n    // ...\n  });\n});\n')),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},"your application has multiple tenants so you want to dynamically create one namespace per tenant")),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},'const workspaces = io.of(/^\\/\\w+$/);\n\nworkspaces.on("connection", socket => {\n  const workspace = socket.nsp;\n\n  workspace.emit("hello");\n});\n')),(0,o.yg)("h2",{id:"main-namespace"},"Main namespace"),(0,o.yg)("p",null,"Until now, you interacted with the main namespace, called ",(0,o.yg)("inlineCode",{parentName:"p"},"/"),". The ",(0,o.yg)("inlineCode",{parentName:"p"},"io")," instance inherits all of its methods:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},'io.on("connection", (socket) => {});\nio.use((socket, next) => { next() });\nio.emit("hello");\n// are actually equivalent to\nio.of("/").on("connection", (socket) => {});\nio.of("/").use((socket, next) => { next() });\nio.of("/").emit("hello");\n')),(0,o.yg)("p",null,"Some tutorials may also mention ",(0,o.yg)("inlineCode",{parentName:"p"},"io.sockets"),", it's simply an alias for ",(0,o.yg)("inlineCode",{parentName:"p"},'io.of("/")'),"."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},'io.sockets === io.of("/")\n')),(0,o.yg)("h2",{id:"custom-namespaces"},"Custom namespaces"),(0,o.yg)("p",null,"To set up a custom namespace, you can call the ",(0,o.yg)("inlineCode",{parentName:"p"},"of")," function on the server-side:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},'const nsp = io.of("/my-namespace");\n\nnsp.on("connection", socket => {\n  console.log("someone connected");\n});\n\nnsp.emit("hi", "everyone!");\n')),(0,o.yg)("h2",{id:"client-initialization"},"Client initialization"),(0,o.yg)("p",null,"Same-origin version:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},'const socket = io(); // or io("/"), the main namespace\nconst orderSocket = io("/orders"); // the "orders" namespace\nconst userSocket = io("/users"); // the "users" namespace\n')),(0,o.yg)("p",null,"Cross-origin/Node.js version:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},'const socket = io("https://example.com"); // or io("https://example.com/"), the main namespace\nconst orderSocket = io("https://example.com/orders"); // the "orders" namespace\nconst userSocket = io("https://example.com/users"); // the "users" namespace\n')),(0,o.yg)("p",null,"In the example above, only one WebSocket connection will be established, and the packets will automatically be routed to the right namespace."),(0,o.yg)("p",null,"Please note that multiplexing will be disabled in the following cases:"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},"multiple creation for the same namespace")),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},"const socket1 = io();\nconst socket2 = io(); // no multiplexing, two distinct WebSocket connections\n")),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},"different domains")),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},'const socket1 = io("https://first.example.com");\nconst socket2 = io("https://second.example.com"); // no multiplexing, two distinct WebSocket connections\n')),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},"usage of the ",(0,o.yg)("a",{parentName:"li",href:"/docs/v4/client-options/#forcenew"},"forceNew")," option")),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},'const socket1 = io();\nconst socket2 = io("/admin", { forceNew: true }); // no multiplexing, two distinct WebSocket connections\n')),(0,o.yg)("h2",{id:"dynamic-namespaces"},"Dynamic namespaces"),(0,o.yg)("p",null,"It is also possible to dynamically create namespaces, either with a regular expression:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},"io.of(/^\\/dynamic-\\d+$/);\n")),(0,o.yg)("p",null,"or with a function:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},"io.of((name, auth, next) => {\n  next(null, true); // or false, when the creation is denied\n});\n")),(0,o.yg)("p",null,"You can have access to the new namespace in the ",(0,o.yg)("inlineCode",{parentName:"p"},"connection")," event:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},'io.of(/^\\/dynamic-\\d+$/).on("connection", (socket) => {\n  const namespace = socket.nsp;\n});\n')),(0,o.yg)("p",null,"The return value of the ",(0,o.yg)("inlineCode",{parentName:"p"},"of()")," method is what we call the parent namespace, from which you can:"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},"register ",(0,o.yg)("a",{parentName:"li",href:"/docs/v4/middlewares/"},"middlewares"))),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},"const parentNamespace = io.of(/^\\/dynamic-\\d+$/);\n\nparentNamespace.use((socket, next) => { next() });\n")),(0,o.yg)("p",null,"The middleware will automatically be registered on each child namespace."),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"/docs/v4/broadcasting-events/"},"broadcast")," events")),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},'const parentNamespace = io.of(/^\\/dynamic-\\d+$/);\n\nparentNamespace.emit("hello"); // will be sent to users in /dynamic-1, /dynamic-2, ...\n')),(0,o.yg)("admonition",{type:"caution"},(0,o.yg)("p",{parentName:"admonition"},"Existing namespaces have priority over dynamic namespaces. For example:"),(0,o.yg)("pre",{parentName:"admonition"},(0,o.yg)("code",{parentName:"pre",className:"language-js"},'// register "dynamic-101" namespace\nio.of("/dynamic-101");\n\nio.of(/^\\/dynamic-\\d+$/).on("connection", (socket) => {\n  // will not be called for a connection on the "dynamic-101" namespace\n});\n'))),(0,o.yg)("h2",{id:"complete-api"},"Complete API"),(0,o.yg)("p",null,"The complete API exposed by the Namespace instance can be found ",(0,o.yg)("a",{parentName:"p",href:"/docs/v4/server-api/#namespace"},"here"),"."))}g.isMDXComponent=!0}}]);