"use strict";(self.webpackChunksample_website=self.webpackChunksample_website||[]).push([[8968],{5680:(e,t,n)=>{n.d(t,{xA:()=>m,yg:()=>y});var r=n(6540);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),c=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},m=function(e){var t=c(e.components);return r.createElement(l.Provider,{value:t},e.children)},p="mdxType",g={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,m=s(e,["components","mdxType","originalType","parentName"]),p=c(n),u=a,y=p["".concat(l,".").concat(u)]||p[u]||g[u]||o;return n?r.createElement(y,i(i({ref:t},m),{},{components:n})):r.createElement(y,i({ref:t},m))}));function y(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[p]="string"==typeof e?e:a,i[1]=s;for(var c=2;c<o;c++)i[c]=n[c];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}u.displayName="MDXCreateElement"},8119:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>g,frontMatter:()=>o,metadata:()=>s,toc:()=>c});var r=n(8168),a=(n(6540),n(5680));const o={title:"Memory usage",sidebar_position:9,slug:"/memory-usage/"},i=void 0,s={unversionedId:"categories/Documentation/memory-usage",id:"categories/Documentation/memory-usage",title:"Memory usage",description:"The resources consumed by your Socket.IO server will mainly depend on:",source:"@site/docs/categories/01-Documentation/memory-usage.md",sourceDirName:"categories/01-Documentation",slug:"/memory-usage/",permalink:"/docs/v4/memory-usage/",draft:!1,editUrl:"https://github.com/socketio/nhonvo.github.io/edit/main/docs/categories/01-Documentation/memory-usage.md",tags:[],version:"current",lastUpdatedAt:1700662402,formattedLastUpdatedAt:"Nov 22, 2023",sidebarPosition:9,frontMatter:{title:"Memory usage",sidebar_position:9,slug:"/memory-usage/"},sidebar:"sidebar",previous:{title:"TypeScript",permalink:"/docs/v4/typescript/"},next:{title:"Installation",permalink:"/docs/v4/server-installation/"}},l={},c=[{value:"Memory usage per WebSocket server implementation",id:"memory-usage-per-websocket-server-implementation",level:2},{value:"Memory usage over time",id:"memory-usage-over-time",level:2}],m={toc:c},p="wrapper";function g(e){let{components:t,...o}=e;return(0,a.yg)(p,(0,r.A)({},m,o,{components:t,mdxType:"MDXLayout"}),(0,a.yg)("p",null,"The resources consumed by your Socket.IO server will mainly depend on:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},"the number of connected clients"),(0,a.yg)("li",{parentName:"ul"},"the number of messages (",(0,a.yg)("a",{parentName:"li",href:"/docs/v4/emitting-events/#basic-emit"},"basic emit"),", ",(0,a.yg)("a",{parentName:"li",href:"/docs/v4/emitting-events/#acknowledgements"},"emit with acknowledgement")," and ",(0,a.yg)("a",{parentName:"li",href:"/docs/v4/broadcasting-events/"},"broadcast"),") received and sent per second")),(0,a.yg)("admonition",{type:"info"},(0,a.yg)("p",{parentName:"admonition"},"The memory usage of the Socket.IO server should scale ",(0,a.yg)("strong",{parentName:"p"},"linearly")," with the number of connected clients.")),(0,a.yg)("admonition",{type:"tip"},(0,a.yg)("p",{parentName:"admonition"},"By default, a reference to the first HTTP request of each session is kept in memory. This reference is needed when working with ",(0,a.yg)("inlineCode",{parentName:"p"},"express-session")," for example (see ",(0,a.yg)("a",{parentName:"p",href:"/how-to/use-with-express-session"},"here"),"), but can be discarded to save memory:"),(0,a.yg)("pre",{parentName:"admonition"},(0,a.yg)("code",{parentName:"pre",className:"language-js"},'io.engine.on("connection", (rawSocket) => {\n  rawSocket.request = null;\n});\n'))),(0,a.yg)("p",null,"The source code to reproduce the results presented in this page can be found ",(0,a.yg)("a",{parentName:"p",href:"https://github.com/socketio/socket.io-benchmarks"},"there"),"."),(0,a.yg)("p",null,"See also:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("a",{parentName:"li",href:"/docs/v4/load-testing/"},"Load testing")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("a",{parentName:"li",href:"/docs/v4/performance-tuning/"},"Performance tuning"))),(0,a.yg)("h2",{id:"memory-usage-per-websocket-server-implementation"},"Memory usage per WebSocket server implementation"),(0,a.yg)("p",null,"The memory usage of the Socket.IO server heavily depends on the memory usage of the underlying WebSocket server implementation."),(0,a.yg)("p",null,"The chart below displays the memory usage of the Socket.IO server, from 0 up to 10 000 connected clients, with:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},"a Socket.IO server based on the ",(0,a.yg)("a",{parentName:"li",href:"https://github.com/websockets/ws"},(0,a.yg)("inlineCode",{parentName:"a"},"ws"))," package (used by default)"),(0,a.yg)("li",{parentName:"ul"},"a Socket.IO server based on the ",(0,a.yg)("a",{parentName:"li",href:"https://github.com/mmdevries/eiows"},(0,a.yg)("inlineCode",{parentName:"a"},"eiows"))," package, a C++ WebSocket server implementation (see ",(0,a.yg)("a",{parentName:"li",href:"/docs/v4/server-installation/#other-websocket-server-implementations"},"installation steps"),")"),(0,a.yg)("li",{parentName:"ul"},"a Socket.IO server based on the ",(0,a.yg)("a",{parentName:"li",href:"https://github.com/uNetworking/uWebSockets.js"},(0,a.yg)("inlineCode",{parentName:"a"},"\xb5WebSockets.js"))," package, a C++ alternative to the Node.js native HTTP server (see ",(0,a.yg)("a",{parentName:"li",href:"/docs/v4/server-installation/#usage-with-uwebsockets"},"installation steps"),")"),(0,a.yg)("li",{parentName:"ul"},"a plain WebSocket server based on the ",(0,a.yg)("a",{parentName:"li",href:"https://github.com/websockets/ws"},(0,a.yg)("inlineCode",{parentName:"a"},"ws"))," package")),(0,a.yg)("p",null,(0,a.yg)("img",{alt:"Chart of the memory usage per WebSocket server implementation",src:n(5988).A,width:"980",height:"473"})),(0,a.yg)("p",null,"Tested on ",(0,a.yg)("inlineCode",{parentName:"p"},"Ubuntu 22.04 LTS")," with Node.js ",(0,a.yg)("inlineCode",{parentName:"p"},"v20.3.0"),", with the following package versions:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"socket.io@4.7.2")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"eiows@6.7.2")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"uWebSockets.js@20.33.0")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"ws@8.11.0"))),(0,a.yg)("h2",{id:"memory-usage-over-time"},"Memory usage over time"),(0,a.yg)("p",null,"The chart below displays the memory usage of the Socket.IO server over time, from 0 up to 10 000 connected clients."),(0,a.yg)("p",null,(0,a.yg)("img",{alt:"Chart of the memory usage over time",src:n(4798).A,width:"961",height:"520"})),(0,a.yg)("admonition",{type:"note"},(0,a.yg)("p",{parentName:"admonition"},"For demonstration purposes, we manually call the garbage collector at the end of each wave of clients:"),(0,a.yg)("pre",{parentName:"admonition"},(0,a.yg)("code",{parentName:"pre",className:"language-js"},'io.on("connection", (socket) => {\n  socket.on("disconnect", () => {\n    const lastToDisconnect = io.of("/").sockets.size === 0;\n    if (lastToDisconnect) {\n      gc();\n    }\n  });\n});\n')),(0,a.yg)("p",{parentName:"admonition"},"Which explains the clean drop in memory usage when the last client disconnects. This is not needed in your application, the garbage collection will be automatically triggered when necessary.")))}g.isMDXComponent=!0},4798:(e,t,n)=>{n.d(t,{A:()=>r});const r=n.p+"assets/images/memory-usage-over-time-79ea9e6413d1fb93cfc2f5e9cf2d7c82.png"},5988:(e,t,n)=>{n.d(t,{A:()=>r});const r=n.p+"assets/images/memory-usage-per-impl-0f33f953418d9d533b3c996ea134bc96.png"}}]);