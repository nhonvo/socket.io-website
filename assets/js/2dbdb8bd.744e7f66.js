"use strict";(self.webpackChunksample_website=self.webpackChunksample_website||[]).push([[6643],{5680:(e,t,n)=>{n.d(t,{xA:()=>c,yg:()=>y});var o=n(6540);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=o.createContext({}),p=function(e){var t=o.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=p(e.components);return o.createElement(l.Provider,{value:t},e.children)},m="mdxType",g={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},u=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),m=p(n),u=r,y=m["".concat(l,".").concat(u)]||m[u]||g[u]||a;return n?o.createElement(y,i(i({ref:t},c),{},{components:n})):o.createElement(y,i({ref:t},c))}));function y(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,i=new Array(a);i[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[m]="string"==typeof e?e:r,i[1]=s;for(var p=2;p<a;p++)i[p]=n[p];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}u.displayName="MDXCreateElement"},8989:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>g,frontMatter:()=>a,metadata:()=>s,toc:()=>p});var o=n(8168),r=(n(6540),n(5680));const a={title:"Socket.IO 1.4.0",slug:"/socket-io-1-4-0/",authors:"rauchg"},i=void 0,s={permalink:"/blog/socket-io-1-4-0/",editUrl:"https://github.com/socketio/socket.io-website/edit/main/blog/2016-01-06-1.4.0.md",source:"@site/blog/2016-01-06-1.4.0.md",title:"Socket.IO 1.4.0",description:"Socket.IO 1.4.0 ship with new features like automatic compression for XHR and WebSockets, lots of bug fixes and significant performance and memory improvements.",date:"2016-01-06T00:00:00.000Z",formattedDate:"January 6, 2016",tags:[],readingTime:2.975,hasTruncateMarker:!0,authors:[{name:"Guillermo Rauch",title:"Maintainer of Socket.IO",url:"https://twitter.com/rauchg",imageURL:"https://github.com/rauchg.png",key:"rauchg"}],frontMatter:{title:"Socket.IO 1.4.0",slug:"/socket-io-1-4-0/",authors:"rauchg"},prevItem:{title:"Socket.IO 1.4.1, 1.4.2 and 1.4.3",permalink:"/blog/socket-io-1-4-1-1-4-2-and-1-4-3/"},nextItem:{title:"Socket.IO 1.3.7",permalink:"/blog/socket-io-1-3-7/"}},l={authorsImageUrls:[void 0]},p=[],c={toc:p},m="wrapper";function g(e){let{components:t,...n}=e;return(0,r.yg)(m,(0,o.A)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.yg)("p",null,"Socket.IO 1.4.0 ship with new features like ",(0,r.yg)("strong",{parentName:"p"},"automatic compression")," for XHR and WebSockets, lots of bug fixes and significant performance and memory improvements."),(0,r.yg)("p",null,"Compression is enabled by default, as it\u2019s highly beneficial for most application payloads. The following example shows the savings for a realtime stream of tweets."),(0,r.yg)("div",{id:"tweets-compression-demo"}),(0,r.yg)("p",null,"The compression gains will vary by transport. For example, WebSocket defaults to a window size of 32kb when ",(0,r.yg)("strong",{parentName:"p"},"DEFLATE")," compression is enabled. Repeated occurrences of strings within that window will be compressed.\nThe following demo (inspired by Julia Evans ",(0,r.yg)("a",{href:"http://jvns.ca/blog/2013/10/24/day-16-gzip-plus-poetry-equals-awesome/"},"work"),") will highlight what the LZ77 algorithm de-duplicates from the traffic sent by the Twitter stream that matches ",(0,r.yg)("em",null,"javascript"),"."),(0,r.yg)("div",{id:"lz77-compression-demo"}),(0,r.yg)("p",{style:{fontSize:"10px",color:"#999"}},"How this demo works: we re-implemented a part of ",(0,r.yg)("a",{style:{color:"#888"},href:"https://github.com/socketio/lz77-compression-demo/blob/master/public/lz77-analyzer.js"},"LZ77 in JavaScript"),". A ",(0,r.yg)("a",{style:{color:"#888"},href:"https://github.com/socketio/lz77-compression-demo/blob/master/public/component.js#L67"},"React component")," then renders the compressed strings."),(0,r.yg)("p",null,"The longer the string, the darker the shade of yellow displayed."),(0,r.yg)("p",null,"In addition to this default behavior, we\u2019ve introduced the capability to perform selective per-message compression, by introducing the ",(0,r.yg)("inlineCode",{parentName:"p"},"compress")," flag when emitting an event."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"socket.compress(true).emit(\u2018hi\u2019, { some: \u2018data\u2019 });\n")),(0,r.yg)("p",null,"To configure the defaults, we\u2019ve introduced the following two options that you can pass to socket.io (and engine.io) when starting the server:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("inlineCode",{parentName:"p"},"perMessageDeflate")," \u2013 options to customize WebSocket compression (",(0,r.yg)("a",{href:"https://github.com/websockets/ws/blob/master/doc/ws.md#optionspermessagedeflate",target:"_blank"},"see here"),") or ",(0,r.yg)("inlineCode",{parentName:"p"},"true")," for defaults (",(0,r.yg)("inlineCode",{parentName:"p"},"true"),").")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("inlineCode",{parentName:"p"},"httpCompression")," \u2013 options to customize compression for HTTP polling transports or ",(0,r.yg)("inlineCode",{parentName:"p"},"true")," for defaults (",(0,r.yg)("inlineCode",{parentName:"p"},"true"),")"))),(0,r.yg)("p",null,"The memory overhead when compression is enabled is not inexistent, however. Make sure to account for a 300kb~ overhead per connection in terms of memory allocation. ",(0,r.yg)("a",{href:"https://www.igvita.com/2013/11/27/configuring-and-optimizing-websocket-compression/"},"Read here")," about the parameters you can customize to change how much memory is allocated and how aggressively data is compressed."),(0,r.yg)("p",null,"The following improvements have been made to the ",(0,r.yg)("strong",{parentName:"p"},(0,r.yg)("a",{href:"https://github.com/socketio/socket.io"},"server")),":"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Assume 443 port when passing ",(0,r.yg)("inlineCode",{parentName:"li"},"https://")," to the ",(0,r.yg)("inlineCode",{parentName:"li"},"origins")," parameter \u2013 Evan Lucas"),(0,r.yg)("li",{parentName:"ul"},"Improve detection of binary data inside events (in the ",(0,r.yg)("inlineCode",{parentName:"li"},"has-binary")," module) \u2013 Gunther Brunner"),(0,r.yg)("li",{parentName:"ul"},"Warn about missing ",(0,r.yg)("inlineCode",{parentName:"li"},"error")," event handlers on sockets to prevent silent hard-to-debug situations"),(0,r.yg)("li",{parentName:"ul"},"Allow a custom function for the ",(0,r.yg)("inlineCode",{parentName:"li"},"allowRequest")," function for origins verification"),(0,r.yg)("li",{parentName:"ul"},"Fixes for \u201cuse strict\u201d environments \u2013 Naoyuki Kanezawa"),(0,r.yg)("li",{parentName:"ul"},"Prevent users calling the ack function multiple times \u2013 Kevin Jose Martin"),(0,r.yg)("li",{parentName:"ul"},"Fixed potential memory leaks with open sockets when upgrade fails \u2013 Naoyuki Kanezawa"),(0,r.yg)("li",{parentName:"ul"},"Fix lingering requests when a polling error occurs \u2013 Naoyuki Kanezawa"),(0,r.yg)("li",{parentName:"ul"},"Drastically more memory efficient when keeping track of clients \u2013 Damien Arrachequesne"),(0,r.yg)("li",{parentName:"ul"},"Drastically more memory efficient when keeping track of rooms \u2013 J\xe9r\xe9my Lal"),(0,r.yg)("li",{parentName:"ul"},"Trigger callback if the client is already in the given room when ",(0,r.yg)("inlineCode",{parentName:"li"},"join")," is called \u2013 Damien Arrachequesne"),(0,r.yg)("li",{parentName:"ul"},"Minor parser fixes and performance improvements.")),(0,r.yg)("p",null,"The following improvements have been made to the ",(0,r.yg)("strong",{parentName:"p"},(0,r.yg)("a",{href:"https://github.com/socketio/socket.io-client"},"client")),":"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Fix for specifying custom ports when connecting"),(0,r.yg)("li",{parentName:"ul"},"2 or more connections to the same namespace now create new sockets, instead of reusing a single one."),(0,r.yg)("li",{parentName:"ul"},"Added new reserved ",(0,r.yg)("inlineCode",{parentName:"li"},"ping")," and ",(0,r.yg)("inlineCode",{parentName:"li"},"pong")," events when a heartbeat is emitted and received."),(0,r.yg)("li",{parentName:"ul"},"Add support for environments that extend Object.prototype \u2013 Damien Arrachequesne"),(0,r.yg)("li",{parentName:"ul"},"Fixes for \u201cuse strict\u201d environments \u2013 Naoyuki Kanezawa"),(0,r.yg)("li",{parentName:"ul"},"Added an ",(0,r.yg)("inlineCode",{parentName:"li"},"extraHeaders")," feature for custom headers in HTTP transports (non-WebSocket)"),(0,r.yg)("li",{parentName:"ul"},"Fix handling of disconnection while in the ",(0,r.yg)("inlineCode",{parentName:"li"},"opening")," state."),(0,r.yg)("li",{parentName:"ul"},"Improved error handling for unmatched acknowledgements."),(0,r.yg)("li",{parentName:"ul"},"Parser fixes and improvements.")),(0,r.yg)("p",null,"We've also released ",(0,r.yg)("strong",{parentName:"p"},(0,r.yg)("a",{href:"https://github.com/socketio/socket.io-redis"},"socket.io-redis"))," ",(0,r.yg)("inlineCode",{parentName:"p"},"0.2.0")," with significant performance improvements."),(0,r.yg)("p",null,"Special thanks to ",(0,r.yg)("em",null,"Damien Arrachequesne"),", ",(0,r.yg)("em",null,"Naoyuki Kanezawa")," and ",(0,r.yg)("em",null,"J\xe9r\xe9my Lal")," for their amazing and continued contributions that made this release possible."))}g.isMDXComponent=!0}}]);