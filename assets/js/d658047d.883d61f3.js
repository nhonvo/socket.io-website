"use strict";(self.webpackChunksample_website=self.webpackChunksample_website||[]).push([[1615],{5680:(e,t,a)=>{a.d(t,{xA:()=>p,yg:()=>u});var n=a(6540);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),d=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},p=function(e){var t=d(e.components);return n.createElement(s.Provider,{value:t},e.children)},g="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),g=d(a),c=r,u=g["".concat(s,".").concat(c)]||g[c]||m[c]||i;return a?n.createElement(u,l(l({ref:t},p),{},{components:a})):n.createElement(u,l({ref:t},p))}));function u(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,l=new Array(i);l[0]=c;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[g]="string"==typeof e?e:r,l[1]=o;for(var d=2;d<i;d++)l[d]=a[d];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"},1103:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>p,contentTitle:()=>s,default:()=>u,frontMatter:()=>o,metadata:()=>d,toc:()=>g});var n=a(8168),r=(a(6540),a(5680)),i=a(1653),l=a(6025);const o={title:"Redis adapter",sidebar_position:2,slug:"/redis-adapter/"},s=void 0,d={unversionedId:"categories/Adapters/adapter-redis",id:"categories/Adapters/adapter-redis",title:"Redis adapter",description:"How it works",source:"@site/docs/categories/05-Adapters/adapter-redis.md",sourceDirName:"categories/05-Adapters",slug:"/redis-adapter/",permalink:"/docs/v4/redis-adapter/",draft:!1,editUrl:"https://github.com/socketio/nhonvo.github.io/edit/main/docs/categories/05-Adapters/adapter-redis.md",tags:[],version:"current",lastUpdatedAt:1711365839,formattedLastUpdatedAt:"Mar 25, 2024",sidebarPosition:2,frontMatter:{title:"Redis adapter",sidebar_position:2,slug:"/redis-adapter/"},sidebar:"sidebar",previous:{title:"Introduction",permalink:"/docs/v4/adapter/"},next:{title:"Redis Streams adapter",permalink:"/docs/v4/redis-streams-adapter/"}},p={},g=[{value:"How it works",id:"how-it-works",level:2},{value:"Supported features",id:"supported-features",level:2},{value:"Installation",id:"installation",level:2},{value:"Compatibility table",id:"compatibility-table",level:2},{value:"Usage",id:"usage",level:2},{value:"With the <code>redis</code> package",id:"with-the-redis-package",level:3},{value:"With the <code>redis</code> package and a Redis cluster",id:"with-the-redis-package-and-a-redis-cluster",level:3},{value:"With the <code>ioredis</code> package",id:"with-the-ioredis-package",level:3},{value:"With the <code>ioredis</code> package and a Redis cluster",id:"with-the-ioredis-package-and-a-redis-cluster",level:3},{value:"With Redis sharded Pub/Sub",id:"with-redis-sharded-pubsub",level:3},{value:"Options",id:"options",level:2},{value:"Default adapter",id:"default-adapter",level:3},{value:"Sharded adapter",id:"sharded-adapter",level:3},{value:"Common questions",id:"common-questions",level:2},{value:"Is there any data stored in Redis?",id:"is-there-any-data-stored-in-redis",level:3},{value:"Do I still need to enable sticky sessions when using the Redis adapter?",id:"do-i-still-need-to-enable-sticky-sessions-when-using-the-redis-adapter",level:3},{value:"What happens when the Redis server is down?",id:"what-happens-when-the-redis-server-is-down",level:3},{value:"Migrating from <code>socket.io-redis</code>",id:"migrating-from-socketio-redis",level:2},{value:"Latest releases",id:"latest-releases",level:2},{value:"Emitter",id:"emitter",level:2},{value:"Installation",id:"installation-1",level:3},{value:"Usage",id:"usage-1",level:3},{value:"Migrating from <code>socket.io-emitter</code>",id:"migrating-from-socketio-emitter",level:3},{value:"Latest releases",id:"latest-releases-1",level:3}],m={toc:g},c="wrapper";function u(e){let{components:t,...a}=e;return(0,r.yg)(c,(0,n.A)({},m,a,{components:t,mdxType:"MDXLayout"}),(0,r.yg)("h2",{id:"how-it-works"},"How it works"),(0,r.yg)("p",null,"The Redis adapter relies on the Redis ",(0,r.yg)("a",{parentName:"p",href:"https://redis.io/topics/pubsub"},"Pub/Sub mechanism"),"."),(0,r.yg)("p",null,"Every packet that is sent to multiple clients (e.g. ",(0,r.yg)("inlineCode",{parentName:"p"},'io.to("room1").emit()')," or ",(0,r.yg)("inlineCode",{parentName:"p"},"socket.broadcast.emit()"),") is:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"sent to all matching clients connected to the current server"),(0,r.yg)("li",{parentName:"ul"},"published in a Redis channel, and received by the other Socket.IO servers of the cluster")),(0,r.yg)(i.A,{alt:"Diagram of how the Redis adapter works",sources:{light:(0,l.A)("/images/broadcasting-redis.png"),dark:(0,l.A)("/images/broadcasting-redis-dark.png")},mdxType:"ThemedImage"}),(0,r.yg)("p",null,"The source code of this adapter can be found ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/socketio/socket.io-redis-adapter"},"here"),"."),(0,r.yg)("h2",{id:"supported-features"},"Supported features"),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:null},"Feature"),(0,r.yg)("th",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"th"},"socket.io")," version"),(0,r.yg)("th",{parentName:"tr",align:null},"Support"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"Socket management"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"4.0.0")),(0,r.yg)("td",{parentName:"tr",align:null},"\u2705 YES (since version ",(0,r.yg)("inlineCode",{parentName:"td"},"6.1.0"),")")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"Inter-server communication"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"4.1.0")),(0,r.yg)("td",{parentName:"tr",align:null},"\u2705 YES (since version ",(0,r.yg)("inlineCode",{parentName:"td"},"7.0.0"),")")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"Broadcast with acknowledgements"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"/docs/v4/changelog/4.5.0"},(0,r.yg)("inlineCode",{parentName:"a"},"4.5.0"))),(0,r.yg)("td",{parentName:"tr",align:null},"\u2705 YES (since version ",(0,r.yg)("inlineCode",{parentName:"td"},"7.2.0"),")")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"Connection state recovery"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"/docs/v4/changelog/4.6.0"},(0,r.yg)("inlineCode",{parentName:"a"},"4.6.0"))),(0,r.yg)("td",{parentName:"tr",align:null},"\u274c NO")))),(0,r.yg)("h2",{id:"installation"},"Installation"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},"npm install @socket.io/redis-adapter\n")),(0,r.yg)("h2",{id:"compatibility-table"},"Compatibility table"),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:null},"Redis Adapter version"),(0,r.yg)("th",{parentName:"tr",align:null},"Socket.IO server version"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"4.x"),(0,r.yg)("td",{parentName:"tr",align:null},"1.x")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"5.x"),(0,r.yg)("td",{parentName:"tr",align:null},"2.x")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"6.0.x"),(0,r.yg)("td",{parentName:"tr",align:null},"3.x")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"6.1.x"),(0,r.yg)("td",{parentName:"tr",align:null},"4.x")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"7.x and above"),(0,r.yg)("td",{parentName:"tr",align:null},"4.3.1 and above")))),(0,r.yg)("h2",{id:"usage"},"Usage"),(0,r.yg)("h3",{id:"with-the-redis-package"},"With the ",(0,r.yg)("inlineCode",{parentName:"h3"},"redis")," package"),(0,r.yg)("admonition",{type:"caution"},(0,r.yg)("p",{parentName:"admonition"},"The ",(0,r.yg)("inlineCode",{parentName:"p"},"redis")," package seems to have problems restoring the Redis subscriptions after reconnection:"),(0,r.yg)("ul",{parentName:"admonition"},(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("a",{parentName:"li",href:"https://github.com/redis/node-redis/issues/2155"},"https://github.com/redis/node-redis/issues/2155")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("a",{parentName:"li",href:"https://github.com/redis/node-redis/issues/1252"},"https://github.com/redis/node-redis/issues/1252"))),(0,r.yg)("p",{parentName:"admonition"},"You may want to use the ",(0,r.yg)("a",{parentName:"p",href:"#with-the-ioredis-package"},(0,r.yg)("inlineCode",{parentName:"a"},"ioredis"))," package instead.")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},'import { createClient } from "redis";\nimport { Server } from "socket.io";\nimport { createAdapter } from "@socket.io/redis-adapter";\n\nconst pubClient = createClient({ url: "redis://localhost:6379" });\nconst subClient = pubClient.duplicate();\n\nawait Promise.all([\n  pubClient.connect(),\n  subClient.connect()\n]);\n\nconst io = new Server({\n  adapter: createAdapter(pubClient, subClient)\n});\n\nio.listen(3000);\n')),(0,r.yg)("h3",{id:"with-the-redis-package-and-a-redis-cluster"},"With the ",(0,r.yg)("inlineCode",{parentName:"h3"},"redis")," package and a Redis cluster"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},'import { createCluster } from "redis";\nimport { Server } from "socket.io";\nimport { createAdapter } from "@socket.io/redis-adapter";\n\nconst pubClient = createCluster({\n  rootNodes: [\n    {\n      url: "redis://localhost:7000",\n    },\n    {\n      url: "redis://localhost:7001",\n    },\n    {\n      url: "redis://localhost:7002",\n    },\n  ],\n});\nconst subClient = pubClient.duplicate();\n\nawait Promise.all([\n  pubClient.connect(),\n  subClient.connect()\n]);\n\nconst io = new Server({\n  adapter: createAdapter(pubClient, subClient)\n});\n\nio.listen(3000);\n')),(0,r.yg)("h3",{id:"with-the-ioredis-package"},"With the ",(0,r.yg)("inlineCode",{parentName:"h3"},"ioredis")," package"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},'import { Redis } from "ioredis";\nimport { Server } from "socket.io";\nimport { createAdapter } from "@socket.io/redis-adapter";\n\nconst pubClient = new Redis();\nconst subClient = pubClient.duplicate();\n\nconst io = new Server({\n  adapter: createAdapter(pubClient, subClient)\n});\n\nio.listen(3000);\n')),(0,r.yg)("h3",{id:"with-the-ioredis-package-and-a-redis-cluster"},"With the ",(0,r.yg)("inlineCode",{parentName:"h3"},"ioredis")," package and a Redis cluster"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},'import { Cluster } from "ioredis";\nimport { Server } from "socket.io";\nimport { createAdapter } from "@socket.io/redis-adapter";\n\nconst pubClient = new Cluster([\n  {\n    host: "localhost",\n    port: 7000,\n  },\n  {\n    host: "localhost",\n    port: 7001,\n  },\n  {\n    host: "localhost",\n    port: 7002,\n  },\n]);\nconst subClient = pubClient.duplicate();\n\nconst io = new Server({\n  adapter: createAdapter(pubClient, subClient)\n});\n\nio.listen(3000);\n')),(0,r.yg)("h3",{id:"with-redis-sharded-pubsub"},"With Redis sharded Pub/Sub"),(0,r.yg)("p",null,"Sharded Pub/Sub was introduced in Redis 7.0 in order to help scaling the usage of Pub/Sub in cluster mode."),(0,r.yg)("p",null,"Reference: ",(0,r.yg)("a",{parentName:"p",href:"https://redis.io/docs/interact/pubsub/#sharded-pubsub"},"https://redis.io/docs/interact/pubsub/#sharded-pubsub")),(0,r.yg)("p",null,"A dedicated adapter can be created with the ",(0,r.yg)("inlineCode",{parentName:"p"},"createShardedAdapter()")," method:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},'import { Server } from "socket.io";\nimport { createClient } from "redis";\nimport { createShardedAdapter } from "@socket.io/redis-adapter";\n\nconst pubClient = createClient({ host: "localhost", port: 6379 });\nconst subClient = pubClient.duplicate();\n\nawait Promise.all([\n  pubClient.connect(),\n  subClient.connect()\n]);\n\nconst io = new Server({\n  adapter: createShardedAdapter(pubClient, subClient)\n});\n\nio.listen(3000);\n')),(0,r.yg)("p",null,"Minimum requirements:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Redis 7.0"),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("a",{parentName:"li",href:"https://github.com/redis/node-redis/commit/3b1bad229674b421b2bc6424155b20d4d3e45bd1"},(0,r.yg)("inlineCode",{parentName:"a"},"redis@4.6.0")))),(0,r.yg)("admonition",{type:"caution"},(0,r.yg)("p",{parentName:"admonition"},"It is not currently possible to use the sharded adapter with the ",(0,r.yg)("inlineCode",{parentName:"p"},"ioredis")," package and a Redis cluster (",(0,r.yg)("a",{parentName:"p",href:"https://github.com/luin/ioredis/issues/1759"},"reference"),").")),(0,r.yg)("h2",{id:"options"},"Options"),(0,r.yg)("h3",{id:"default-adapter"},"Default adapter"),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:null},"Name"),(0,r.yg)("th",{parentName:"tr",align:null},"Description"),(0,r.yg)("th",{parentName:"tr",align:null},"Default value"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"key")),(0,r.yg)("td",{parentName:"tr",align:null},"The prefix for the Redis Pub/Sub channels."),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"socket.io"))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"requestsTimeout")),(0,r.yg)("td",{parentName:"tr",align:null},"After this timeout the adapter will stop waiting from responses to request."),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"5_000"))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"publishOnSpecificResponseChannel")),(0,r.yg)("td",{parentName:"tr",align:null},"Whether to publish a response to the channel specific to the requesting node."),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"false"))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"parser")),(0,r.yg)("td",{parentName:"tr",align:null},"The parser to use for encoding and decoding messages sent to Redis."),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"-"))))),(0,r.yg)("admonition",{type:"tip"},(0,r.yg)("p",{parentName:"admonition"},"Setting the ",(0,r.yg)("inlineCode",{parentName:"p"},"publishOnSpecificResponseChannel")," option to ",(0,r.yg)("inlineCode",{parentName:"p"},"true")," is more efficient since the responses (for example when calling ",(0,r.yg)("inlineCode",{parentName:"p"},"fetchSockets()")," or ",(0,r.yg)("inlineCode",{parentName:"p"},"serverSideEmit()"),") are only sent to the requesting server, and not to all the servers."),(0,r.yg)("p",{parentName:"admonition"},"However, it currently defaults to ",(0,r.yg)("inlineCode",{parentName:"p"},"false")," for backward-compatibility.")),(0,r.yg)("h3",{id:"sharded-adapter"},"Sharded adapter"),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:null},"Name"),(0,r.yg)("th",{parentName:"tr",align:null},"Description"),(0,r.yg)("th",{parentName:"tr",align:null},"Default value"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"channelPrefix")),(0,r.yg)("td",{parentName:"tr",align:null},"The prefix for the Redis Pub/Sub channels."),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"socket.io"))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"subscriptionMode")),(0,r.yg)("td",{parentName:"tr",align:null},"The subscription mode impacts the number of Redis Pub/Sub channels used by the adapter."),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"dynamic"))))),(0,r.yg)("h2",{id:"common-questions"},"Common questions"),(0,r.yg)("h3",{id:"is-there-any-data-stored-in-redis"},"Is there any data stored in Redis?"),(0,r.yg)("p",null,"No, the Redis adapter uses the ",(0,r.yg)("a",{parentName:"p",href:"https://redis.io/topics/pubsub"},"Pub/Sub mechanism")," to forward the packets between the Socket.IO servers, so there are no keys stored in Redis."),(0,r.yg)("h3",{id:"do-i-still-need-to-enable-sticky-sessions-when-using-the-redis-adapter"},"Do I still need to enable sticky sessions when using the Redis adapter?"),(0,r.yg)("p",null,"Yes. Failing to do so will result in HTTP 400 responses (you are reaching a server that is not aware of the Socket.IO session)."),(0,r.yg)("p",null,"More information can be found ",(0,r.yg)("a",{parentName:"p",href:"/docs/v4/using-multiple-nodes/#why-is-sticky-session-required"},"here"),"."),(0,r.yg)("h3",{id:"what-happens-when-the-redis-server-is-down"},"What happens when the Redis server is down?"),(0,r.yg)("p",null,"In case the connection to the Redis server is severed, the packets will only be sent to the clients that are connected to the current server."),(0,r.yg)("h2",{id:"migrating-from-socketio-redis"},"Migrating from ",(0,r.yg)("inlineCode",{parentName:"h2"},"socket.io-redis")),(0,r.yg)("p",null,"The package was renamed from ",(0,r.yg)("inlineCode",{parentName:"p"},"socket.io-redis")," to ",(0,r.yg)("inlineCode",{parentName:"p"},"@socket.io/redis-adapter")," in ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/socketio/socket.io-redis-adapter/releases/tag/7.0.0"},"v7"),", in order to match the name of the Redis emitter (",(0,r.yg)("inlineCode",{parentName:"p"},"@socket.io/redis-emitter"),")."),(0,r.yg)("p",null,"To migrate to the new package, you'll need to make sure to provide your own Redis clients, as the package will no longer create Redis clients on behalf of the user."),(0,r.yg)("p",null,"Before:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},'const redisAdapter = require("socket.io-redis");\n\nio.adapter(redisAdapter({ host: "localhost", port: 6379 }));\n')),(0,r.yg)("p",null,"After:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},'const { createClient } = require("redis");\nconst { createAdapter } = require("@socket.io/redis-adapter");\n\nconst pubClient = createClient({ url: "redis://localhost:6379" });\nconst subClient = pubClient.duplicate();\n\nio.adapter(createAdapter(pubClient, subClient));\n')),(0,r.yg)("admonition",{type:"tip"},(0,r.yg)("p",{parentName:"admonition"},"The communication protocol between the Socket.IO servers has not been updated, so you can have some servers with ",(0,r.yg)("inlineCode",{parentName:"p"},"socket.io-redis")," and some others with ",(0,r.yg)("inlineCode",{parentName:"p"},"@socket.io/redis-adapter")," at the same time.")),(0,r.yg)("h2",{id:"latest-releases"},"Latest releases"),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:null},"Version"),(0,r.yg)("th",{parentName:"tr",align:null},"Release date"),(0,r.yg)("th",{parentName:"tr",align:null},"Release notes"),(0,r.yg)("th",{parentName:"tr",align:null},"Diff"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"8.3.0")),(0,r.yg)("td",{parentName:"tr",align:null},"March 2024"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://github.com/socketio/socket.io-redis-adapter/releases/tag/8.3.0"},"link")),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://github.com/socketio/socket.io-redis-adapter/compare/8.2.1...8.3.0"},(0,r.yg)("inlineCode",{parentName:"a"},"8.2.1...8.3.0")))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"8.2.1")),(0,r.yg)("td",{parentName:"tr",align:null},"May 2023"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://github.com/socketio/socket.io-redis-adapter/releases/tag/8.2.1"},"link")),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://github.com/socketio/socket.io-redis-adapter/compare/8.2.0...8.2.1"},(0,r.yg)("inlineCode",{parentName:"a"},"8.2.0...8.2.1")))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"8.2.0")),(0,r.yg)("td",{parentName:"tr",align:null},"May 2023"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://github.com/socketio/socket.io-redis-adapter/releases/tag/8.2.0"},"link")),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://github.com/socketio/socket.io-redis-adapter/compare/8.1.0...8.2.0"},(0,r.yg)("inlineCode",{parentName:"a"},"8.1.0...8.2.0")))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"8.1.0")),(0,r.yg)("td",{parentName:"tr",align:null},"February 2023"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://github.com/socketio/socket.io-redis-adapter/releases/tag/8.1.0"},"link")),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://github.com/socketio/socket.io-redis-adapter/compare/8.0.0...8.1.0"},(0,r.yg)("inlineCode",{parentName:"a"},"8.0.0...8.1.0")))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"8.0.0")),(0,r.yg)("td",{parentName:"tr",align:null},"December 2022"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://github.com/socketio/socket.io-redis-adapter/releases/tag/8.0.0"},"link")),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://github.com/socketio/socket.io-redis-adapter/compare/7.2.0...8.0.0"},(0,r.yg)("inlineCode",{parentName:"a"},"7.2.0...8.0.0")))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"7.2.0")),(0,r.yg)("td",{parentName:"tr",align:null},"May 2022"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://github.com/socketio/socket.io-redis-adapter/releases/tag/7.2.0"},"link")),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://github.com/socketio/socket.io-redis-adapter/compare/7.1.0...7.2.0"},(0,r.yg)("inlineCode",{parentName:"a"},"7.1.0...7.2.0")))))),(0,r.yg)("p",null,(0,r.yg)("a",{parentName:"p",href:"https://github.com/socketio/socket.io-redis-adapter/blob/main/CHANGELOG.md"},"Complete changelog")),(0,r.yg)("h2",{id:"emitter"},"Emitter"),(0,r.yg)("p",null,"The Redis emitter allows sending packets to the connected clients from another Node.js process:"),(0,r.yg)(i.A,{alt:"Diagram of how the Redis emitter works",sources:{light:(0,l.A)("/images/redis-emitter.png"),dark:(0,l.A)("/images/redis-emitter-dark.png")},mdxType:"ThemedImage"}),(0,r.yg)("p",null,"This emitter is also available in several languages:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Javascript: ",(0,r.yg)("a",{parentName:"li",href:"https://github.com/socketio/socket.io-redis-emitter"},"https://github.com/socketio/socket.io-redis-emitter")),(0,r.yg)("li",{parentName:"ul"},"Java: ",(0,r.yg)("a",{parentName:"li",href:"https://github.com/sunsus/socket.io-java-emitter"},"https://github.com/sunsus/socket.io-java-emitter")),(0,r.yg)("li",{parentName:"ul"},"Python: ",(0,r.yg)("a",{parentName:"li",href:"https://pypi.org/project/socket.io-emitter/"},"https://pypi.org/project/socket.io-emitter/")),(0,r.yg)("li",{parentName:"ul"},"PHP: ",(0,r.yg)("a",{parentName:"li",href:"https://github.com/rase-/socket.io-php-emitter"},"https://github.com/rase-/socket.io-php-emitter")),(0,r.yg)("li",{parentName:"ul"},"Golang: ",(0,r.yg)("a",{parentName:"li",href:"https://github.com/yosuke-furukawa/socket.io-go-emitter"},"https://github.com/yosuke-furukawa/socket.io-go-emitter")),(0,r.yg)("li",{parentName:"ul"},"Perl: ",(0,r.yg)("a",{parentName:"li",href:"https://metacpan.org/pod/SocketIO::Emitter"},"https://metacpan.org/pod/SocketIO::Emitter")),(0,r.yg)("li",{parentName:"ul"},"Rust: ",(0,r.yg)("a",{parentName:"li",href:"https://github.com/epli2/socketio-rust-emitter"},"https://github.com/epli2/socketio-rust-emitter"))),(0,r.yg)("h3",{id:"installation-1"},"Installation"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},"npm install @socket.io/redis-emitter redis\n")),(0,r.yg)("h3",{id:"usage-1"},"Usage"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},'import { Emitter } from "@socket.io/redis-emitter";\nimport { createClient } from "redis";\n\nconst redisClient = createClient({ url: "redis://localhost:6379" });\n\nredisClient.connect().then(() => {\n  const emitter = new Emitter(redisClient);\n\n  setInterval(() => {\n    emitter.emit("time", new Date);\n  }, 5000);\n});\n')),(0,r.yg)("p",null,"Note: with ",(0,r.yg)("inlineCode",{parentName:"p"},"redis@3"),", calling ",(0,r.yg)("inlineCode",{parentName:"p"},"connect()")," on the Redis client is not needed:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},'import { Emitter } from "@socket.io/redis-emitter";\nimport { createClient } from "redis";\n\nconst redisClient = createClient({ url: "redis://localhost:6379" });\nconst emitter = new Emitter(redisClient);\n\nsetInterval(() => {\n  emitter.emit("time", new Date);\n}, 5000);\n')),(0,r.yg)("p",null,"Please refer to the cheatsheet ",(0,r.yg)("a",{parentName:"p",href:"/docs/v4/adapter/#emitter-cheatsheet"},"here"),"."),(0,r.yg)("h3",{id:"migrating-from-socketio-emitter"},"Migrating from ",(0,r.yg)("inlineCode",{parentName:"h3"},"socket.io-emitter")),(0,r.yg)("p",null,"The package was renamed from ",(0,r.yg)("inlineCode",{parentName:"p"},"socket.io-emitter")," to ",(0,r.yg)("inlineCode",{parentName:"p"},"@socket.io/redis-emitter")," in ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/socketio/socket.io-redis-emitter/releases/tag/4.0.0"},"v4"),", in order to better reflect the relationship with Redis."),(0,r.yg)("p",null,"To migrate to the new package, you'll need to make sure to provide your own Redis clients, as the package will no longer create Redis clients on behalf of the user."),(0,r.yg)("p",null,"Before:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},'const io = require("socket.io-emitter")({ host: "127.0.0.1", port: 6379 });\n')),(0,r.yg)("p",null,"After:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},'const { Emitter } = require("@socket.io/redis-emitter");\nconst { createClient } = require("redis");\n\nconst redisClient = createClient();\nconst io = new Emitter(redisClient);\n')),(0,r.yg)("h3",{id:"latest-releases-1"},"Latest releases"),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:null},"Version"),(0,r.yg)("th",{parentName:"tr",align:null},"Release date"),(0,r.yg)("th",{parentName:"tr",align:null},"Release notes"),(0,r.yg)("th",{parentName:"tr",align:null},"Diff"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"5.1.0")),(0,r.yg)("td",{parentName:"tr",align:null},"January 2023"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://github.com/socketio/socket.io-redis-emitter/releases/tag/5.1.0"},"link")),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://github.com/socketio/socket.io-redis-emitter/compare/5.0.0...5.1.0"},(0,r.yg)("inlineCode",{parentName:"a"},"5.0.0...5.1.0")))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"5.0.0")),(0,r.yg)("td",{parentName:"tr",align:null},"September 2022"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://github.com/socketio/socket.io-redis-emitter/releases/tag/5.0.1"},"link")),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://github.com/socketio/socket.io-redis-emitter/compare/4.1.1...5.0.0"},(0,r.yg)("inlineCode",{parentName:"a"},"4.1.1...5.0.0")))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"4.1.1")),(0,r.yg)("td",{parentName:"tr",align:null},"January 2022"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://github.com/socketio/socket.io-redis-emitter/releases/tag/4.1.1"},"link")),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://github.com/socketio/socket.io-redis-emitter/compare/4.1.0...4.1.1"},(0,r.yg)("inlineCode",{parentName:"a"},"4.1.0...4.1.1")))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"4.1.0")),(0,r.yg)("td",{parentName:"tr",align:null},"May 2021"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://github.com/socketio/socket.io-redis-emitter/releases/tag/4.1.0"},"link")),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://github.com/socketio/socket.io-redis-emitter/compare/4.0.0...4.1.0"},(0,r.yg)("inlineCode",{parentName:"a"},"4.0.0...4.1.0")))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"4.0.0")),(0,r.yg)("td",{parentName:"tr",align:null},"March 2021"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://github.com/socketio/socket.io-redis-emitter/releases/tag/4.0.0"},"link")),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("a",{parentName:"td",href:"https://github.com/socketio/socket.io-redis-emitter/compare/3.2.0...4.0.0"},(0,r.yg)("inlineCode",{parentName:"a"},"3.2.0...4.0.0")))))),(0,r.yg)("p",null,(0,r.yg)("a",{parentName:"p",href:"https://github.com/socketio/socket.io-redis-emitter/blob/main/CHANGELOG.md"},"Complete changelog")))}u.isMDXComponent=!0}}]);